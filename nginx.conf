http {
    include       mime.types;
    types { application/javascript js mjs; }

    server {
        listen 80;
        server_name example.com;
        root /var/www/html;

        # Política de íconos: los íconos se descargan desde la CDN de ArenaNet
        # o pueden servirse desde este servidor ajustando las URLs.

        # Serve web workers without SPA fallback
        location ^~ /dist/js/workers/ {
            try_files $uri =404;
            default_type application/javascript;
        }

        # Return 404 for missing files under /dist/js
        location ^~ /dist/js/ {
            try_files $uri =404;
            default_type application/javascript;
        }

        # Serve service worker directly without SPA fallback
        location = /service-worker.min.js {
            try_files $uri =404;
            default_type application/javascript;
        }

        # Cache static assets for 30 days
        location ~* \.(js|css|png|mp4)$ {
            expires 30d;
            add_header Cache-Control "public, max-age=2592000, stale-while-revalidate=2592000";
        }

        # SPA fallback for other routes
        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}
